<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${board.newsTitle}">칼럼 상세</title>
    <link rel="stylesheet" th:href="@{/css/cInfo.css}">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body th:attr="data-newsIdx=${board.newsIdx},
              data-memberIdx=${loginMember != null ? loginMember.memberIdx : ''},
              data-lawyerIdx=${loginLawyer != null ? loginLawyer.lawyerIdx : ''},
              data-isAdmin=${loginAdmin != null and loginAdmin.adminRole == 'admin'}">
<div class="include" th:replace="~{include/header :: header}"></div>

<main class="page-cInfo">
    <div class="sideMenu" th:replace="~{include/nSide :: nSide}"></div>

    <!-- 드라이브 대표이미지 id -->
    <div class="wrap" th:with="driveId=${board.driveFileId}">
        <!-- 제목 -->
         <div class="tida">
            <h1 class="title" th:text="${board.newsTitle}">제목</h1>

            <!-- 날짜 -->
            <p class="date"
            th:text="${#temporals.format(board.newsRegDate, 'yyyy-MM-dd')}">
                2025-10-31
            </p>    
        </div>
        <!-- 작성자 영역 -->
        <div class="meta">
            <div class="left">
                <!-- 변호사 사진: 있으면 그거, 없으면 placeholder -->
                <a th:if="${board.lawyer != null and board.lawyer.lawyerIdx != null}"
                   th:href="@{/lawyer/profile/{lawyerIdx}(lawyerIdx=${board.lawyer.lawyerIdx})}"
                   style="text-decoration: none; display: inline-block;">
                    <img class="poto"
                         th:if="${board.lawyer.lawyerImgPath != null}"
                         th:src="${board.lawyer.lawyerImgPath}"
                         alt="변호사 사진">
                    <img class="poto"
                         th:if="${board.lawyer.lawyerImgPath == null}"
                         src="https://placehold.co/150x200?text=%EB%B3%80%ED%98%B8%EC%82%AC"
                         alt="변호사 사진">
                </a>
                <div th:if="${board.lawyer == null or board.lawyer.lawyerIdx == null}">
                    <img class="poto"
                         src="https://placehold.co/150x200?text=%EB%B3%80%ED%98%B8%EC%82%AC"
                         alt="변호사 사진">
                </div>

                <!-- 이름 -->
                <p class="writer" th:if="${board.lawyer != null and board.lawyer.lawyerIdx != null}">
                    <a th:href="@{/lawyer/profile/{lawyerIdx}(lawyerIdx=${board.lawyer.lawyerIdx})}"
                       style="text-decoration: none; color: inherit;"
                       th:text="${board.lawyer.lawyerName + ' 변호사'}">홍길동 변호사</a>
                </p>
                <p class="writer" th:if="${board.lawyer == null or board.lawyer.lawyerIdx == null}">
                    변호사
                </p>
            </div>

            <p class="view"
               th:text="|조회수 ${board.newsViews}|">
                조회수 0
            </p>
        </div>

        <!-- 대표 이미지: 칼럼에도 driveFileId가 들어올 수 있으니 조건부로 -->
        <img class="hero"
             th:if="${driveId != null}"
             th:src="|https://drive.google.com/thumbnail?id=${driveId}&sz=w1300|"
             alt="대표이미지">

        <!-- 본문 -->
        <article class="article">
            <!-- 텍스트로 저장돼 있으면 -->
            <p class="para" th:text="${board.newsContent}">칼럼 내용</p>
            <!-- 만약 HTML로 저장돼 있으면 위 p 지우고 아래 거 -->
            <!-- <div th:utext="${board.newsContent}"></div> -->
        </article>

        <!-- 버튼들 -->
        <div class="actions">
            <!-- 작성자이거나 관리자(admin_role='admin')일 때 수정/삭제 버튼 표시 -->
            <a class="btn"
               th:if="${canModifyOrDelete}"
               th:href="@{|/newsBoard/modify?newsIdx=${board.newsIdx}|}">수정</a>

            <form th:if="${canModifyOrDelete}" 
                  th:action="@{/newsBoard/delete}" 
                  method="post" 
                  style="display:inline;">
                <input type="hidden" name="newsIdx" th:value="${board.newsIdx}">
                <button class="btn" type="submit">삭제</button>
            </form>

            <!-- 목록은 항상 표시 -->
            <a class="btn" th:href="@{/newsBoard/list(category=4)}">목록</a>
        </div>

        <!-- 댓글 (공지사항이 아닌 경우에만 표시) -->
        <section class="cmt open" th:if="${canComment}" th:classappend="${loginMember == null and loginLawyer == null}">
            <div class="top">
                <h3>댓글</h3>
            </div>

            <div class="write">
                <div class="row">
                    <textarea class="textbox" id="cText" 
                              th:placeholder="${loginMember == null and loginLawyer == null} ? '로그인 후 댓글을 남길 수 있습니다' : '내용 (Ctrl+Enter 등록)'"
                              th:disabled="${loginMember == null and loginLawyer == null}"></textarea>
                    <button class="submit" id="cBtn" type="button"
                            th:disabled="${loginMember == null and loginLawyer == null}">등록</button>
                </div>
            </div>

            <table class="list">
                <thead>
                <tr>
                    <th style="width:160px">닉네임</th>
                    <th>내용</th>
                    <th style="width:120px">날짜</th>
                </tr>
                </thead>
                <tbody id="cBody"></tbody>
            </table>
        </section>
    </div>
</main>

<div class="include" th:replace="~{include/footer :: footer}"></div>
<script th:src="@{/js/js.js}"></script>
<script th:src="@{/js/chatIcon.js}"></script>
<script th:src="@{/js/cInfo.js}"></script>
</body>
</html>
