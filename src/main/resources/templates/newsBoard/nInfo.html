<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${board.newsTitle}">뉴스 보기</title>
    <link rel="stylesheet" th:href="@{/css/nInfo.css}">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body th:attr="data-newsIdx=${board.newsIdx},
              data-memberIdx=${loginMember != null ? loginMember.memberIdx : ''},
              data-lawyerIdx=${loginLawyer != null ? loginLawyer.lawyerIdx : ''},
              data-isAdmin=${loginAdmin != null and loginAdmin.adminRole == 'admin'}">
<div class="include" th:replace="~{include/header :: header}"></div>

<main class="page-nInfo">
    <div class="sideMenu" th:replace="~{include/nSide :: nSide}"></div>

    <!-- board = NewsBoardEntity -->
    <div class="wrap"
         th:with="
            cat=${board.category.categoryIdx},
            driveId=${board.driveFileId},
            writer=${board.admin != null ? board.admin.adminName : (board.lawyer != null ? board.lawyer.lawyerName : '관리자')}
         ">

        <!-- 제목/날짜/작성자/조회수 -->
        <div class="tida">
            <h1 class="title" th:text="${board.newsTitle}">제목</h1>
            <p class="date" th:text="${#temporals.format(board.newsRegDate, 'yyyy-MM-dd')}">2025-10-31</p>
        </div>

        <div class="meta">
            <div class="left">
                 <p class="writer"
           th:if="${board.category.categoryIdx == 2}"
           th:text="|${writer} 기자|">
            작성자 기자
        </p>
            </div>
            <p class="view"
               id="view"
               th:attr="data-views=${board.newsViews}"
               th:text="|조회수 ${board.newsViews}|">
                조회수 0
            </p>
        </div>

        <!-- 대표 이미지 / 동영상 -->
        <!-- 뉴스(2)일 때만 드라이브 이미지 노출 -->
      <!-- 뉴스(2)일 때만 표시 -->
<div th:if="${board.category.categoryIdx == 2}">
  <img class="hero" th:if="${imgUrl != null}" th:src="${imgUrl}" alt="대표이미지">
</div>

        <!-- 동영상(3)일 때만 유튜브 -->
        <div th:if="${cat == 3}"
             th:with="
                rawUrl=${board.videoUrl},
                vid1=${#strings.contains(rawUrl, 'v=') ? #strings.substringAfter(rawUrl, 'v=') : rawUrl},
                videoId=${#strings.contains(vid1, '&') ? #strings.substringBefore(vid1, '&') : vid1}
             "
             class="hero hero-video">
            <iframe th:src="|https://www.youtube.com/embed/${videoId}|"
                    width="100%" height="480"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
            </iframe>
        </div>

        <!-- 공지(cat == 1)는 위의 이미지/영상 블록이 아예 렌더링 안 됨 -->

        <!-- 본문 -->
        <article class="article">
            <!-- news_content 가 긴 텍스트라고 가정 -->
            <p class="para" th:utext="${#strings.replace(board.newsContent, '\n', '<br>')}">
                본문 내용
            </p>
        </article>

        <!-- 버튼들 -->
        <div class="actions"
             th:with="
                cat=${board.category.categoryIdx},
                isAdminWriter=${loginAdmin != null and board.admin != null and loginAdmin.adminIdx == board.admin.adminIdx},
                isLawyerWriter=${loginLawyer != null and board.lawyer != null and loginLawyer.lawyerIdx == board.lawyer.lawyerIdx},
                isAdmin=${loginAdmin != null and loginAdmin.adminRole == 'admin'}
             ">
            <!-- 작성자이거나 관리자(admin_role='admin')일 때 수정/삭제 버튼 표시 -->
            <a class="btn"
               th:if="${isAdminWriter or isLawyerWriter or isAdmin}"
               th:href="@{/newsBoard/modify(newsIdx=${board.newsIdx})}">수정</a>

            <form th:if="${isAdminWriter or isLawyerWriter or isAdmin}"
                  th:action="@{/newsBoard/delete}"
                  method="post"
                  style="display:inline;">
                <input type="hidden" name="newsIdx" th:value="${board.newsIdx}">
                <button class="btn" type="submit">삭제</button>
            </form>

            <!-- 목록은 항상 표시 -->
            <a class="btn" th:href="@{/newsBoard/list(category=${cat})}">목록</a>
        </div>

        <!-- 댓글 (공지사항이 아닌 경우에만 표시) -->
        <section class="cmt open" th:if="${canComment}" th:classappend="${loginMember == null and loginLawyer == null}">
            <div class="top">
                <h3>댓글</h3>
            </div>

            <div class="write">
                <div class="row">
                    <textarea id="cText" 
                              th:placeholder="${loginMember == null and loginLawyer == null} ? '로그인 후 댓글을 남길 수 있습니다' : '내용 (Ctrl+Enter 등록)'"
                              th:disabled="${loginMember == null and loginLawyer == null}"></textarea>
                    <button class="submit" id="cBtn" type="button"
                            th:disabled="${loginMember == null and loginLawyer == null}">등록</button>
                </div>
            </div>

            <table class="list">
                <thead>
                <tr>
                    <th style="width:160px">닉네임</th>
                    <th>내용</th>
                    <th style="width:120px">날짜</th>
                </tr>
                </thead>
                <tbody id="cBody"></tbody>
            </table>
        </section>
    </div>
</main>

<div class="include" th:replace="~{include/footer :: footer}"></div>

<script th:src="@{/js/js.js}"></script>
<script th:src="@{/js/chatIcon.js}"></script>
<script th:src="@{/js/nInfo.js}"></script>
</body>
</html>
