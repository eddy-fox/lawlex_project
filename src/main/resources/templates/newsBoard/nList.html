<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${categoryIdx == 2} ? 'NEWS'
                 : (${categoryIdx == 3} ? '동영상' : '칼럼')">
        소식 리스트
    </title>
    <link rel="stylesheet" th:href="@{/css/nList.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="include" th:replace="~{include/header :: header}"></div>

<main class="page-nList">
    <div class="sideMenu" th:replace="~{include/nSide :: nSide}"></div>

    <div class="among">

        <!-- 공지(1)는 여기 안 씀 -->
        <div th:if="${categoryIdx == 1}">
            이 페이지는 공지사항용이 아닙니다.
        </div>

        <section class="frame" th:if="${categoryIdx != 1}">

            <div class="list-top">
    <h1 class="list-title"
        th:text="${categoryIdx == 2} ? '뉴스'
                 : (${categoryIdx == 3} ? '동영상'
                 : (${categoryIdx == 4} ? '칼럼' : '목록'))">
        목록
    </h1>

    <!-- 로그인만 돼 있으면 보여주기 (실제 권한은 컨트롤러에서 다시 체크) -->
    <a th:if="${loginAdmin != null or loginLawyer != null}"
       th:href="@{/newsBoard/write(category=${categoryIdx})}"
       class="btn-write">
        글쓰기
    </a>
    </div>

            <!-- 리스트가 비었을 때 -->
            <p th:if="${#lists.isEmpty(boards)}">등록된 글이 없습니다.</p>

            <!-- 리스트 아이템 -->
            <a th:each="board : ${boards}"
   th:href="@{/newsBoard/detail(newsIdx=${board.newsIdx})}"
   class="news-link item">

  <!-- 왼쪽 텍스트 -->
  <div class="news-text">
    <h3 class="subject" th:text="${board.newsTitle}">제목</h3>
    <p class="summary" th:text="${#strings.abbreviate(board.newsContent, 80)}">요약</p>
    <div class="date" th:text="${board.newsRegDate}">2025-10-30</div>
  </div>

  <!-- 오른쪽 썸네일 (뉴스/동영상만) -->
  <div th:if="${categoryIdx == 2 or categoryIdx == 3}"
       class="thumb" 
       aria-hidden="true"
       th:with="imgUrl=${categoryIdx == 2 ? (board.newsImgPath != null && #strings.startsWith(board.newsImgPath,'http')
                            ? board.newsImgPath
                            : (board.driveFileId != null
                                ? 'https://storage.googleapis.com/lawlex-82006.firebasestorage.app/' + board.driveFileId
                                : null))
                            : null},
                videoUrl=${categoryIdx == 3 and board.videoId != null ? ('https://img.youtube.com/vi/' + board.videoId + '/hqdefault.jpg') : null}">
    <img th:if="${imgUrl != null or videoUrl != null}" 
         th:src="${imgUrl != null ? imgUrl : videoUrl}" 
         alt="thumbnail">
    <div th:if="${imgUrl == null and videoUrl == null}" class="thumb-placeholder">이미지</div>
  </div>
                <!-- 4(칼럼)는 썸네일 없음 -->
            </a>

        </section>

        <!-- 페이지네이션 -->
        <nav class="pagination"
             aria-label="페이지네이션"
             th:if="${categoryIdx != 1} and ${page.totalPages} > 1">
            <a th:if="${currentPage > 1}"
               th:href="@{/newsBoard/list(category=${categoryIdx}, page=${currentPage - 1})}"
               class="page-link prev">이전</a>

            <a th:each="p : ${#numbers.sequence(startPage, endPage)}"
               th:href="@{/newsBoard/list(category=${categoryIdx}, page=${p})}"
               th:text="${p}"
               th:classappend="${p} == ${currentPage} ? 'active'">
            </a>

            <a th:if="${currentPage < page.totalPages}"
               th:href="@{/newsBoard/list(category=${categoryIdx}, page=${currentPage + 1})}"
               class="page-link next">다음</a>
        </nav>

    </div>
</main>

<div class="include" th:replace="~{include/footer :: footer}"></div>
<script th:src="@{/js/js.js}"></script>
<script th:src="@{/js/chatIcon.js}"></script>
<script th:src="@{/js/nList.js}"></script>
<script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // 전달된 alert 메세지 출력
        /*]]>*/
    </script>
</body>
</html>
