<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상담글 상세</title>
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/reBoard.css}">
</head>
<body>
  <div class="include" th:replace="~{include/header :: header}"></div>
  <main class="page-reBoard">
    <div class="sideMenu" th:replace="~{include/bSide :: bSide}"></div>
    <div class="wrap">
      <div class="backdrop">
        <form class="card">
          <div class="inner">
            <h1 class="post-title" th:text="${boardEntity.boardTitle}"></h1>
            <div class="post-meta" th:text="${#temporals.format(boardEntity.boardRegDate, 'yyyy-MM-dd')}"></div>
            <div class="card-text" th:text="${boardEntity.boardContent}"></div>

            <div class="edit">
              <a class="link" th:href="@{|/board/modify/${boardEntity.boardIdx}|}"
              sec:authorize="isAuthenticated()" 
              th:if="${(boardEntity.member != null and #authentication != null and #authentication.principal != null and #authentication.principal.memberIdx != null and #authentication.principal.memberIdx == boardEntity.member.memberIdx) or (isAdmin != null and isAdmin)}" 
              th:text="수정"></a>
              <a class="link delete" href="javascript:void(0);" th:data-uri="@{|/board/delete/${boardEntity.boardIdx}|}"
              sec:authorize="isAuthenticated()" 
              th:if="${(boardEntity.member != null and #authentication != null and #authentication.principal != null and #authentication.principal.memberIdx != null and #authentication.principal.memberIdx == boardEntity.member.memberIdx) or (isAdmin != null and isAdmin)}" 
              th:text="삭제"></a>
            </div>

            <div class="ans" th:each="reBoardEntity : ${boardEntity.reboardList}">
              <a th:id="|reBoardEntity_${reBoardEntity.reBoardIdx}|"></a>
              <div class="card-body">
                <div class="card-text" th:text="${reBoardEntity.reboardContent}"></div>
                <div class="badge bg-light text-dark p-2 text-start">
                  <div class="mb-2">
                    <span th:if="${reBoardEntity.lawyer != null}" th:text="${reBoardEntity.lawyer.lawyerName}"></span>
                  </div>
                  <div th:text="${#temporals.format(reBoardEntity.reboardRegDate, 'yyyy-MM-dd')}"></div>
                </div>
              </div>
              <div class="my-3">
                <a href="javascript:void(0);" class="recommend btn btn-sm btn-outline-secondary" th:data-uri="@{|/reboard/vote/${reBoardEntity.reboardIdx}|}">도움됐어요
                  <span class="badge rounded-pill bg-success" th:text="${#lists.size(reBoardEntity.voter)}"></span>
                </a>
                <a th:href="@{|/reboard/modify/${reBoardEntity.reboardIdx}|}" class="btn btn-sm btn-outline-secondary"
                sec:authorize="isAuthenticated()" 
                th:if="${reBoardEntity.lawyer != null and #authentication != null and #authentication.principal != null and #authentication.principal.lawyerName != null and #authentication.principal.lawyerName == reBoardEntity.lawyer.lawyerName}" 
                th:text="수정"></a>
                <a href="javascript:void(0);" th:data-uri="@{|/reboard/delete/${reBoardEntity.reboardIdx}|}"
                class="delete btn btn-sm btn-outline-secondary"
                sec:authorize="isAuthenticated()"
                th:if="${reBoardEntity.lawyer != null and #authentication != null and #authentication.principal != null and #authentication.principal.lawyerName != null and #authentication.principal.lawyerName == reBoardEntity.lawyer.lawyerName}" 
                th:text="삭제"></a>
              </div>
              <!-- 답변 작성 -->
              <form th:action="@{|/reboard/create/${boardEntity.boardIdx}|}" th:object="${reBoardForm}"| method="post" class="my-3">
                <div th:replace="~{form_errors :: formErrorsFragment}"></div>
                <textarea sec:authorize="isAnonymous()" disabled
                th:field="*{reboardContent}" class="form-control" rows="10"></textarea>
                <textarea sec:authorize="isAuthenticated()"
                th:field="*{reboardContent}" class="form-control" rows="10"></textarea>
                <input type="submit" value="답변 등록" class="btn btn-primary my-2">
              </form>
              <!-- <article class="cmt">
                <div class="cmt-head">
                  <div class="cmt-avatar"><img src="https://via.placeholder.com/72x96" alt="프로필"></div>
                  <div class="chip">김현중 변호사</div>
                  <div class="chip">2025-09-29 21:14</div>
                  <div class="chip">😊 도움됐어요 <strong>2</strong></div>
                </div>
                <div class="cmt-body">
                    소액의 벌금 정도로 마무리 가능성이 높습니다.
                    유사 사건 다수 처리 경험이 있습니다.
                    상담 답변은 사무장이 아닌 변호사가 직접 작성합니다.
                </div>
              </article> -->
            </div>

            <!-- <div class="note" id="replyBox">
              <div class="note-header">
                <span class="badge" id="statusText" th:if="${ReBoard}">변호사님의 답변을 기다리고 있어요.
                  <button id="open" class="btn">답변하기</button>
                </span>
              </div>
              <div id="replyArea" class="hidden">
                <textarea id="ta" class="textarea" placeholder="1. ~&#10;2. ~&#10;3. ~ 처럼 줄바꿈으로 항목을 쓰면 목록으로 들어갑니다." minlength="10"></textarea>
                <div class="counter"><span id="count">0</span> / <span id="min">10</span>자 <span id="ok" class="ok hidden">가능</span></div>
                <div class="actions">
                  <button id="submit" class="btn" disabled>등록</button>
                  <button id="cancel" class="btn ghost">취소</button>
                </div>
              </div>
            </div> -->

            <div id="comments"></div>

          </div>
        </form>
      </div>
    </div>
  </main>
    <div class="include" th:replace="~{include/footer :: footer}"></div>
  <script th:src="@{/js/reBoard.js}"></script>   
</body>
</html>