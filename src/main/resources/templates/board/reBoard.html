<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒë‹´ê¸€ ìƒì„¸</title>
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/reBoard.css}">
</head>
<body>
  <div class="include" th:replace="~{include/header :: header}"></div>
  <main class="page-reBoard">
    <div class="sideMenu" th:replace="~{include/bSide :: bSide(interestIdx=${interestIdx})}"></div>
    <div class="wrap">
      <div class="backdrop">
       
          <div class="inner">
            <h1 class="post-title" th:text="${boardEntity.boardTitle}"></h1>
            <div class="post-meta" th:text="${#temporals.format(boardEntity.boardRegDate, 'yyyy-MM-dd')}"></div>
            <div class="card-text" th:text="${boardEntity.boardContent}"></div>

            <div class="edit">
              <a class="link" th:href="@{|/board/modify/${boardEntity.boardIdx}|}"
              sec:authorize="isAuthenticated()" 
              th:if="${(boardEntity.member != null and #authentication != null and #authentication.principal != null and #authentication.principal.memberIdx != null and #authentication.principal.memberIdx == boardEntity.member.memberIdx) or (isAdmin != null and isAdmin)}" 
              th:text="ìˆ˜ì •"></a>
              <a class="link delete" href="javascript:void(0);" th:data-uri="@{|/board/delete/${boardEntity.boardIdx}|}"
              sec:authorize="isAuthenticated()" 
              th:if="${(boardEntity.member != null and #authentication != null and #authentication.principal != null and #authentication.principal.memberIdx != null and #authentication.principal.memberIdx == boardEntity.member.memberIdx) or (isAdmin != null and isAdmin)}" 
              th:text="ì‚­ì œ"></a>
            </div>

            <!-- ë‹µë³€ ëª©ë¡ ì„¹ì…˜ -->
            <div class="answers-section">
              <div class="answers-header">
                <div class="answers-header-left">
                  <span class="answers-count" th:text="${boardEntity.reboardList != null ? (#lists.size(boardEntity.reboardList) + 'ê°œ ë‹µë³€') : '0ê°œ ë‹µë³€'}"></span>
                  <button type="button" class="btn-answer-toggle" id="answerToggleBtn"
                          sec:authorize="isAuthenticated()" 
                          th:if="${loginUser != null and loginUser.role == 'LAWYER' and loginUser.lawyerIdx != null}">
                    ë‹µë³€ ë‹¬ê¸°
                  </button>
                </div>
                <div class="answers-sort">
                  <select class="sort-select">
                    <option>ìµœì </option>
                    <option>ì¶”ì²œìˆœ</option>
                  </select>
                </div>
              </div>

              <!-- ë‹µë³€ ì‘ì„± í¼ (í† ê¸€) -->
              <div class="answer-form-wrapper" id="answerFormWrapper" style="display: none;"
                   sec:authorize="isAuthenticated()" 
                   th:if="${loginUser != null and loginUser.role == 'LAWYER' and loginUser.lawyerIdx != null}">
                <div class="answer-avatar">
                  <img th:if="${loginLawyer != null and loginLawyer.lawyerImgPath != null and loginLawyer.lawyerImgPath != ''}" 
                       th:src="${loginLawyer.lawyerImgPath}" 
                       alt="ë³€í˜¸ì‚¬ í”„ë¡œí•„"
                       class="lawyer-profile-img-small">
                  <span th:if="${loginLawyer == null or loginLawyer.lawyerImgPath == null or loginLawyer.lawyerImgPath == ''}">A</span>
                </div>
                <form th:action="@{|/reboard/create/${boardEntity.boardIdx}|}" th:object="${reBoardForm}" method="post" class="answer-form">
                  <textarea th:field="*{reboardContent}" 
                  class="answer-textarea" 
                  placeholder="ë‹µë³€ìë‹˜, ì •ë³´ë¥¼ ê³µìœ í•´ ì£¼ì„¸ìš”." 
                  rows="4"></textarea>
                  <div class="answer-form-actions">
                    <button type="submit" class="btn-answer-submit">ë‹µë³€</button>
                    <button type="button" class="btn-answer-cancel" id="answerCancelBtn">ì·¨ì†Œ</button>
                  </div>
                </form>
              </div>

              <!-- ë‹µë³€ ë¦¬ìŠ¤íŠ¸ (ë¡œê·¸ì¸ í•„ìš”) -->
              <div class="answers-list-wrapper" th:classappend="${loginUser == null ? 'login-required' : ''}">
                <!-- ë¹„ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
                <div class="answers-overlay" th:if="${loginUser == null}">
                  <div class="overlay-content">
                    <p class="overlay-message">ë¡œê·¸ì¸ í›„ì— ë‹µë³€ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
                    <a th:href="@{/member/login}" class="overlay-login-btn">ë¡œê·¸ì¸í•˜ê¸°</a>
                  </div>
                </div>
                
                <!-- ë‹µë³€ ë¦¬ìŠ¤íŠ¸ -->
                <div class="answers-list" th:if="${boardEntity.reboardList != null and !#lists.isEmpty(boardEntity.reboardList)}">
                <div class="answer-item" th:each="reboard : ${boardEntity.reboardList}">
                  <div class="answer-avatar-large">
                    <img th:if="${(reboard.lawyer != null and reboard.lawyer.lawyerImgPath != null and reboard.lawyer.lawyerImgPath != '') or (reboard.lawyerIdx != null and reboard.lawyerIdx.lawyerImgPath != null and reboard.lawyerIdx.lawyerImgPath != '')}" 
                         th:src="${reboard.lawyer != null ? reboard.lawyer.lawyerImgPath : (reboard.lawyerIdx != null ? reboard.lawyerIdx.lawyerImgPath : '')}" 
                         alt="ë³€í˜¸ì‚¬ í”„ë¡œí•„"
                         class="lawyer-profile-img">
                    <span th:if="${(reboard.lawyer == null or reboard.lawyer.lawyerImgPath == null or reboard.lawyer.lawyerImgPath == '') and (reboard.lawyerIdx == null or reboard.lawyerIdx.lawyerImgPath == null or reboard.lawyerIdx.lawyerImgPath == '')}">A</span>
                  </div>
                  <div class="answer-content-wrapper">
                    <div class="answer-header">
                      <div class="answer-author">
                        <!-- GPT ë‹µë³€ì¸ ê²½ìš°: ë³€í˜¸ì‚¬ ë¶™ì´ì§€ ì•ŠìŒ -->
                        <span class="answer-author-name" 
                              th:if="${reboard.lawyer != null and reboard.lawyer.lawyerIdx == 205}"
                              th:text="${reboard.lawyer.lawyerName != null ? reboard.lawyer.lawyerName : 'AI ë²•ë¥ ìƒë‹´'}"></span>
                        
                        <!-- ì¼ë°˜ ë³€í˜¸ì‚¬ ë‹µë³€ì¸ ê²½ìš°: ë³€í˜¸ì‚¬ ë¶™ì„ -->
                        <a th:if="${reboard.lawyer != null and reboard.lawyer.lawyerIdx != null and reboard.lawyer.lawyerIdx != 205}"
                           th:href="@{/lawyer/profile/{lawyerIdx}(lawyerIdx=${reboard.lawyer.lawyerIdx})}"
                           class="answer-author-name"
                           style="text-decoration: none; color: inherit;"
                           th:text="${reboard.lawyer.lawyerName != null ? (reboard.lawyer.lawyerName + ' ë³€í˜¸ì‚¬') : 'ìµëª…'}"></a>
                        <span class="answer-author-name" 
                              th:if="${reboard.lawyer == null or reboard.lawyer.lawyerIdx == 205}"
                              th:text="'ìµëª…'"></span>
                        <span class="answer-date" th:if="${reboard.reboardRegDate != null}" th:text="${#temporals.format(reboard.reboardRegDate, 'yyyy-MM-dd')}"></span>
                      </div>
                    </div>
                    <!-- GPT ë‹µë³€ ê²½ê³  ë¬¸êµ¬ -->
                    <div class="gpt-disclaimer" 
                        th:if="${reboard.lawyer != null and reboard.lawyer.lawyerIdx == 205}">
                      <strong>ì´ ë‹µë³€ì€ AIê°€ ìƒì„±í•œ ì°¸ê³ ìš© ì •ë³´ì´ë©° ë²•ë¥ ì  ì •í™•ì„±ì´ ë³´ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‹¤ì œ í–‰ë™ì´ë‚˜ ì˜ì‚¬ê²°ì •ì— í™œìš©í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ì „ë¬¸ê°€ì˜ í™•ì¸ì„ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</strong>
                    </div>
                    <div class="answer-content" th:text="${reboard.reboardContent}"></div>
                    <div class="answer-actions">
                      <!-- ì¼ë°˜íšŒì›ìš© ë„ì›€ì´ëì–´ìš” ë²„íŠ¼ (ì¹´ìš´íŠ¸ í‘œì‹œìš©, í•­ìƒ í‘œì‹œ) -->
                      <a th:href="@{|/reboard/member-like/${reboard.reboardIdx}|}" 
                        class="recommend-link like-btn"
                        th:classappend="${(loginUser != null and loginUser.role == 'LAWYER') ? 'disabled' : ''}"
                        th:if="${reboard.lawyer != null and reboard.lawyer.lawyerIdx != null and reboard.lawyer.lawyerIdx != 205}"
                        th:data-liked="${(likedReboards != null and likedReboards.containsKey(reboard.reboardIdx) and likedReboards.get(reboard.reboardIdx) == true) ? 'true' : 'false'}"
                        th:data-member="${(loginUser != null and loginUser.role == 'MEMBER' and loginUser.memberIdx != null) ? 'true' : 'false'}"
                        th:data-lawyer="${(loginUser != null and loginUser.role == 'LAWYER') ? 'true' : 'false'}"
                        th:data-reboard-idx="${reboard.reboardIdx}">
                        ë„ì›€ì´ëì–´ìš”
                        <span class="recommend-count" th:text="${reboard.memberVoter != null ? #lists.size(reboard.memberVoter) : 0}"></span>
                      </a>
                      <a th:href="@{|/reboard/modify/${reboard.reboardIdx}|}" 
                         class="answer-reply-btn"
                         sec:authorize="isAuthenticated()" 
                         th:if="${reboard.lawyer != null and #authentication != null and #authentication.principal != null and #authentication.principal.lawyerName != null and #authentication.principal.lawyerName == reboard.lawyer.lawyerName}">
                        ìˆ˜ì •
                      </a>
                      <a href="javascript:void(0);" 
                         class="answer-reply-btn delete"
                         th:data-uri="@{|/reboard/delete/${reboard.reboardIdx}|}"
                         sec:authorize="isAuthenticated()" 
                         th:if="${(reboard.lawyer != null and #authentication != null and #authentication.principal != null and #authentication.principal.lawyerName != null and #authentication.principal.lawyerName == reboard.lawyer.lawyerName) or (isAdmin != null and isAdmin)}">
                        ì‚­ì œ
                      </a>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>
              <!-- <article class="cmt">
                <div class="cmt-head">
                  <div class="cmt-avatar"><img src="https://via.placeholder.com/72x96" alt="í”„ë¡œí•„"></div>
                  <div class="chip">ê¹€í˜„ì¤‘ ë³€í˜¸ì‚¬</div>
                  <div class="chip">2025-09-29 21:14</div>
                  <div class="chip">ğŸ˜Š ë„ì›€ëì–´ìš” <strong>2</strong></div>
                </div>
                <div class="cmt-body">
                    ì†Œì•¡ì˜ ë²Œê¸ˆ ì •ë„ë¡œ ë§ˆë¬´ë¦¬ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
                    ìœ ì‚¬ ì‚¬ê±´ ë‹¤ìˆ˜ ì²˜ë¦¬ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤.
                    ìƒë‹´ ë‹µë³€ì€ ì‚¬ë¬´ì¥ì´ ì•„ë‹Œ ë³€í˜¸ì‚¬ê°€ ì§ì ‘ ì‘ì„±í•©ë‹ˆë‹¤.
                </div>
              </article> -->


            <!-- <div class="note" id="replyBox">
              <div class="note-header">
                <span class="badge" id="statusText" th:if="${ReBoard}">ë³€í˜¸ì‚¬ë‹˜ì˜ ë‹µë³€ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”.
                  <button id="open" class="btn">ë‹µë³€í•˜ê¸°</button>
                </span>
              </div>
              <div id="replyArea" class="hidden">
                <textarea id="ta" class="textarea" placeholder="1. ~&#10;2. ~&#10;3. ~ ì²˜ëŸ¼ ì¤„ë°”ê¿ˆìœ¼ë¡œ í•­ëª©ì„ ì“°ë©´ ëª©ë¡ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤." minlength="10"></textarea>
                <div class="counter"><span id="count">0</span> / <span id="min">10</span>ì <span id="ok" class="ok hidden">ê°€ëŠ¥</span></div>
                <div class="actions">
                  <button id="submit" class="btn" disabled>ë“±ë¡</button>
                  <button id="cancel" class="btn ghost">ì·¨ì†Œ</button>
                </div>
              </div>
            </div> -->

            <div id="comments"></div>

          </div>
   
      </div>
    </div>
  </main>
    <div class="include" th:replace="~{include/footer :: footer}"></div>
  <script th:src="@{/js/js.js}"></script>
  <script th:src="@{/js/chatIcon.js}"></script>
  <script th:src="@{/js/reBoard.js}"></script>   
  <script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // ì „ë‹¬ëœ alert ë©”ì„¸ì§€ ì¶œë ¥
        /*]]>*/
    </script>
  <script th:src="@{/js/reBoard.js}"></script>
  <script>
    // ë„ì›€ì´ëì–´ìš” ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
    (function() {
      const likeButtons = document.querySelectorAll('.like-btn');
      likeButtons.forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          const isLiked = this.getAttribute('data-liked');
          const isMember = this.getAttribute('data-member');
          const isLawyer = this.getAttribute('data-lawyer');
          
          // ë³€í˜¸ì‚¬íšŒì›ì€ í´ë¦­ ë¶ˆê°€
          if (isLawyer === 'true') {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
          }
          
          if (isMember !== 'true') {
            e.preventDefault();
            return false;
          }
          
          if (isLiked === 'true') {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            alert('ì´ë¯¸ ì¶”ì²œí•˜ì‹  ë‹µë³€ì…ë‹ˆë‹¤.');
            return false;
          }
        }, true); // capture phaseì—ì„œ ì‹¤í–‰
      });
    })();
  </script>
  <script th:if="${alreadyLiked != null and alreadyLiked == true}">
    alert('ì´ë¯¸ ì¶”ì²œí•˜ì‹  ë‹µë³€ì…ë‹ˆë‹¤.');
  </script>
</body>
</html>