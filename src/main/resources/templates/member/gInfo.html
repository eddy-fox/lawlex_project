<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일반회원마이페이지</title>
    <link rel="stylesheet" th:href="@{/css/gInfo.css}">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
  <div class="include" th:replace="~{include/header :: header}"></div>

  <main class="page-gInfo" th:with="m=${member != null ? member : session.loginMember}">
    <div class="container">
      <h1>마이페이지</h1>

      <section class="card">

        <!-- ✅ 포인트 영역을 위로 올리기 + 버튼 하나만 -->
        <div class="split">
          <div class="pane">
            <div class="pane-title">
              <span>포인트</span>
              <span class="strong-num"
                    th:text="${member != null ? member.memberPoint : 0}">
                0 P
              </span>
            </div>
            <div class="pill-row">
              <a class="pill-btn" th:href="@{/member/point}">포인트 관리</a>
            </div>
          </div>
        </div>

        <!-- ✅ 사진(avatar) 제거된 프로필 헤더 -->
        <div class="profile-head">
          <!-- <div class="avatar">사진</div>  사진 영역 제거 -->

          <div class="info">
            <div class="nickname">
              <div class="name"
                   th:text="${m != null ? m.memberNickname : '닉네임사용자'}">
                닉네임사용자
              </div>
              <div class="tag">일반 회원</div>
            </div>

            <div class="meta-line">
              <span th:if="${m == null or m.memberProvider == null or #strings.isEmpty(m.memberProvider) or m.memberProvider == 'local'}"
                    th:text="${m != null ? m.memberId : 'user001'}">user001</span>
              <span th:text="${m != null ? m.memberPhone : '010-1234-5678'}">
                010-1234-5678
              </span>
              <span th:text="${m != null ? m.memberEmail : 'user@example.com'}">
                user@example.com
              </span>
            </div>
          </div>

          <div class="actions-top">
            <a class="btn ghost" 
               th:href="${isAdminView != null and isAdminView and memberIdx != null ? 
                         '/member/gmodify?memberIdx=' + memberIdx : 
                         '/member/gmodify'}" 
               role="button">정보수정</a>

            <form id="logoutForm" th:action="@{/member/logout}" method="post" style="display:none;">
              <th:block th:if="${_csrf != null}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
              </th:block>
            </form>
            <button class="btn ghost" type="button"
                    onclick="document.getElementById('logoutForm').submit()">
              로그아웃
            </button>
          </div>
        </div>
      </section>

      <section class="list-card">
        <div class="list-title">
          <span>내가 쓴 글</span>
          <a class="link-more" th:href="@{/member/mypage/myPosts}">전체보기</a>
        </div>

        <div class="item-list">
          <div class="row-item"
               th:each="b : ${myBoards}">
            <a class="row-main" 
               th:href="@{/board/detail/{boardIdx}(boardIdx=${b.boardIdx})}"
               th:text="${b.boardTitle}">
              정보통신망법 침입 및 명예훼손 대응방법
            </a>
            <div class="row-sub"
                 th:text="|${#temporals.format(b.boardRegDate, 'yyyy-MM-dd')} · 조회 ${b.boardViews}|">
              2025-09-29 · 조회 12
            </div>
          </div>

          <div class="row-item" th:if="${#lists.isEmpty(myBoards)}">
            <div class="row-main">작성한 게시글이 없습니다.</div>
          </div>
        </div>
      </section>

      <!-- 내가 쓴 댓글 -->
      <section class="list-card">
        <div class="list-title">
          <span>내가 쓴 댓글</span>
          <a class="link-more" th:href="@{/member/mypage/myComments}">전체보기</a>
        </div>

        <div class="item-list">
          <div class="row-item"
               th:each="c : ${myComments}">
            <a class="row-main" 
               th:href="@{/newsBoard/detail(newsIdx=${c.newsIdx})}"
               th:text="${c.commentContent}">
              “상담 정말 도움됐습니다 감사합니다.”
            </a>
            <div class="row-sub"
                 th:text="${#temporals.format(c.commentRegDate, 'yyyy-MM-dd')}">
              2025-09-29
            </div>
          </div>

          <div class="row-item" th:if="${#lists.isEmpty(myComments)}">
            <div class="row-main">작성한 댓글이 없습니다.</div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <div class="include" th:replace="~{include/footer :: footer}"></div>
  <script th:src="@{/js/js.js}"></script>
  <script th:src="@{/js/chatIcon.js}"></script>
  <script th:src="@{/js/gInfo.js}"></script>
  <script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // 전달된 alert 메세지 출력
        /*]]>*/
    </script>
</body>
</html>
