<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일반회원정보수정</title>
  <link rel="stylesheet" th:href="@{/css/gModify.css}">
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
  <div class="include" th:replace="~{include/header :: header}"></div>

  <main class="page-gModify" th:with="me=${member != null ? member : session.loginMember}">
    <section class="container-narrow" style="max-width: 720px; margin: 0 auto 3rem;">

      <header class="page-head" aria-label="페이지 제목" style="text-align: center; margin-top: 2rem;">
        <h1 class="title">정보수정</h1>
        <span class="role-badge">일반회원</span>
      </header>

      <div id="msgArea"
           class="alert"
           role="status"
           aria-live="polite"
           style="display:none; text-align:center; margin:1.5rem auto;">
      </div>

      <!-- 프로필 수정 -->
      <section class="card form-card" aria-labelledby="secProfile" style="margin-top: 2.5rem;">
        <h2 id="secProfile"
            class="sub-ttl"
            style="text-align:left; margin:0 0 1.5rem 0;">
          프로필 수정
        </h2>

        <form id="formProfile" th:action="@{/member/api/profile}" method="post" novalidate>
          <th:block th:if="${_csrf != null}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          </th:block>
          <input type="hidden" th:if="${isAdminEdit != null and isAdminEdit and memberIdx != null}" 
                 name="memberIdx" th:value="${memberIdx}"/>

          <div class="form-grid">
            <!-- 아이디는 수정 불가라 입력칸 제거, 필요하면 상단 타이틀이나 마이페이지에서만 노출 -->

            <label for="memberNickname" class="label">닉네임</label>
            <div class="control">
              <input id="memberNickname" name="memberNickname" class="input" type="text"
                     th:value="${me != null ? me.memberNickname : ''}" placeholder="닉네임">
            </div>

            <label for="memberEmail" class="label">이메일</label>
            <div class="control">
              <input id="memberEmail" name="memberEmail" class="input" type="email"
                     th:value="${me != null ? me.memberEmail : ''}" placeholder="이메일 입력">
            </div>

            <div class="label">관심분야(3개)</div>
            <div class="control">
              <div class="grid-3">
                <select id="interestIdx1" name="interestIdx1" class="input select" required>
                  <option value="">관심분야 선택 1</option>
                  <option th:each="it : ${interests}"
                          th:value="${it.interestIdx}"
                          th:selected="${me != null and me.interestIdx1 != null and me.interestIdx1 == it.interestIdx}"
                          th:text="${it.interestName}"></option>
                </select>

                <select id="interestIdx2" name="interestIdx2" class="input select" required>
                  <option value="">관심분야 선택 2</option>
                  <option th:each="it : ${interests}"
                          th:value="${it.interestIdx}"
                          th:selected="${me != null and me.interestIdx2 != null and me.interestIdx2 == it.interestIdx}"
                          th:text="${it.interestName}"></option>
                </select>

                <select id="interestIdx3" name="interestIdx3" class="input select" required>
                  <option value="">관심분야 선택 3</option>
                  <option th:each="it : ${interests}"
                          th:value="${it.interestIdx}"
                          th:selected="${me != null and me.interestIdx3 != null and me.interestIdx3 == it.interestIdx}"
                          th:text="${it.interestName}"></option>
                </select>
              </div>
              <small class="help">세 개는 서로 다른 항목이어야 합니다.</small>
            </div>
          </div>

          <div class="actions right"
               style="text-align: right; margin-top: 2rem;">
            <a class="btn ghost" th:href="@{/member/mypage}" role="button"
               style="margin-right: 0.75rem;">
              취소
            </a>
            <button id="btnSaveProfile"
                    class="btn primary"
                    type="submit"
                    style="background:#000; color:#fff; border:none; padding:0.45rem 1.4rem; border-radius:4px; font-weight:500; cursor:pointer;">
              수정완료
            </button>
          </div>
        </form>
      </section>

      <!-- 비밀번호 변경 -->
      <section class="card form-card" aria-labelledby="secPw" style="margin-top: 3.5rem;">
        <h2 id="secPw"
            class="sub-ttl"
            style="text-align:left; margin:0 0 1.5rem 0;">
          비밀번호 변경
        </h2>

        <form id="formPw" th:action="@{/member/api/changePassword}" method="post" novalidate>
          <th:block th:if="${_csrf != null}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          </th:block>

          <div class="form-grid">
            <label for="pw_id" class="label">아이디</label>
            <div class="control">
              <input id="pw_id" name="memberId" class="input" type="text"
                     th:value="${me != null ? me.memberId : ''}"
                     placeholder="아이디" autocomplete="username" readonly
                     style="background-color: #f5f5f5; cursor: not-allowed;">
            </div>

            <label for="pw_phone" class="label">전화번호</label>
            <div class="control">
              <input id="pw_phone" name="memberPhone" class="input" type="text"
                     placeholder="예) 010-1234-5678" inputmode="numeric">
            </div>

            <label for="pw_idnum" class="label">생년월일(6자리)</label>
            <div class="control">
              <input id="pw_idnum" name="memberIdnum" class="input" type="text"
                     placeholder="예) 990101" inputmode="numeric" maxlength="6">
            </div>

            <label for="newPassword" class="label">새 비밀번호</label>
            <div class="control">
              <input id="newPassword" name="newPassword" class="input" type="password" placeholder="새 비밀번호">
            </div>

            <label for="confirmPassword" class="label">비밀번호 확인</label>
            <div class="control">
              <input id="confirmPassword" name="confirmPassword" class="input" type="password" placeholder="비밀번호 확인">
            </div>
          </div>

          <div class="actions right"
               style="text-align: right; margin-top: 2rem;">
            <button id="btnChangePw"
                    class="btn primary"
                    type="submit"
                    style="background:#000; color:#fff; border:none; padding:0.45rem 1.4rem; border-radius:4px; font-weight:500; cursor:pointer;">
              비밀번호 변경
            </button>
          </div>
        </form>
      </section>

      <!-- 회원탈퇴 -->
      <section class="card form-card" aria-labelledby="secLeave" style="margin-top: 3.5rem; margin-bottom: 1.5rem;">
        <h2 id="secLeave"
            class="sub-ttl"
            style="text-align:left; margin:0 0 1.5rem 0;">
          회원탈퇴
        </h2>

        <form id="formDelete" th:action="@{/member/api/deactivate}" method="post" novalidate>
          <th:block th:if="${_csrf != null}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          </th:block>

          <div class="warning" style="margin-bottom: 1.5rem;">
            <p class="warn-ttl">탈퇴 전 꼭 확인해주세요</p>
            <ul class="warn-list">
              <li>탈퇴 후 계정과 이용 기록은 복구할 수 없습니다.</li>
              <li>법적 보관 의무가 있는 최소 정보만 남기고 모두 삭제됩니다.</li>
              <li>다시 이용하시려면 새 계정으로 가입해야 합니다.</li>
            </ul>
            <label class="check">
              <input id="agreeDelete" type="checkbox">
              위 내용을 확인했으며, 탈퇴에 동의합니다.
            </label>
          </div>

          <div class="form-grid">
            <label for="del_phone" class="label">전화번호</label>
            <div class="control">
              <input id="del_phone" name="memberPhone" class="input" type="text"
                     placeholder="예) 010-1234-5678" inputmode="numeric">
            </div>

            <label for="del_idnum" class="label">생년월일(6자리)</label>
            <div class="control">
              <input id="del_idnum" name="memberIdnum" class="input" type="text"
                     placeholder="예) 990101" inputmode="numeric" maxlength="6">
            </div>
          </div>

          <div class="actions right"
               style="text-align: right; margin-top: 2rem;">
            <button id="btnDelete"
                    class="btn danger"
                    type="submit"
                    disabled
                    style="background:#000; color:#fff; border:none; padding:0.45rem 1.4rem; border-radius:4px; font-weight:500; cursor:pointer;">
              회원탈퇴
            </button>
          </div>
        </form>
      </section>

    </section>
  </main>

  <div class="include" th:replace="~{include/footer :: footer}"></div>
  <script th:src="@{/js/js.js}"></script>
<script th:src="@{/js/chatIcon.js}"></script>
<script th:src="@{/js/gModify.js}"></script>
<script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // 전달된 alert 메세지 출력
        /*]]>*/
    </script>
</body>
</html>
