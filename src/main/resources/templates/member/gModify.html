<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일반회원정보수정</title>
  <link rel="stylesheet" th:href="@{/css/gModify.css}">
  <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<div class="include" th:replace="~{include/header :: header}"></div>

<main class="page-gModify" th:with="me=${m}">
  <section class="center-card">
    <div class="head">
      <h1 class="title">정보수정</h1>
      <span class="role-badge">일반회원</span>
    </div>

    <!-- 알림 영역 -->
    <div id="msgArea" class="alert" style="display:none"></div>

    <!-- 프로필 수정 -->
    <form id="formProfile" class="form" th:action="@{/member/api/profile}" method="post" novalidate>
      <th:block th:if="${_csrf != null}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      </th:block>

      <!-- 아이디(읽기전용) -->
      <div class="field">
        <label class="label" for="memberId">아이디</label>
        <div class="input-wrap">
          <input class="input" id="memberId" name="memberId" type="text"
                 th:value="${me != null ? me.memberId : ''}" readonly>
        </div>
      </div>

      <!-- 닉네임 -->
      <div class="field">
        <label class="label" for="memberNickname">닉네임</label>
        <div class="input-wrap">
          <input class="input" id="memberNickname" name="memberNickname" type="text"
                 th:value="${me != null ? me.memberNickname : ''}" placeholder="닉네임">
        </div>
      </div>

      <!-- 이메일 -->
      <div class="field">
        <label class="label" for="memberEmail">이메일</label>
        <div class="input-wrap">
          <input class="input" id="memberEmail" name="memberEmail" type="email"
                 th:value="${me != null ? me.memberEmail : ''}" placeholder="이메일 입력">
        </div>
      </div>

      <!-- 관심분야 (회원가입 디자인과 동일: 셀렉트 3개) -->
      <div class="field">
        <span class="label">관심분야(3개)</span>
        <div class="grid-3">
          <select class="input" id="interestIdx1" name="interestIdx1" required>
            <option value="">-- 선택 --</option>
            <option th:each="it : ${interests}"
                    th:value="${it.interestIdx}"
                    th:selected="${me != null and me.interestIdx1 != null and me.interestIdx1 == it.interestIdx}"
                    th:text="${it.interestName}"></option>
          </select>

          <select class="input" id="interestIdx2" name="interestIdx2" required>
            <option value="">-- 선택 --</option>
            <option th:each="it : ${interests}"
                    th:value="${it.interestIdx}"
                    th:selected="${me != null and me.interestIdx2 != null and me.interestIdx2 == it.interestIdx}"
                    th:text="${it.interestName}"></option>
          </select>

          <select class="input" id="interestIdx3" name="interestIdx3" required>
            <option value="">-- 선택 --</option>
            <option th:each="it : ${interests}"
                    th:value="${it.interestIdx}"
                    th:selected="${me != null and me.interestIdx3 != null and me.interestIdx3 == it.interestIdx}"
                    th:text="${it.interestName}"></option>
          </select>
        </div>
        <small class="help">세 개는 서로 다른 항목이어야 합니다.</small>
      </div>

      <div class="actions">
        <a class="btn-main btn-ghost" th:href="@{/member/mypage}" role="button">취소</a>
        <button class="btn-main" id="btnSaveProfile" type="submit">수정완료</button>
      </div>
    </form>

    <div class="divider"></div>

    <!-- 비밀번호 변경 (하단 입력으로 본인확인: 전화번호 + 생년월일) -->
    <h2 class="sub-ttl">비밀번호 변경</h2>
    <form id="formPw" class="form" th:action="@{/member/api/changePassword}" method="post" novalidate>
      <th:block th:if="${_csrf != null}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      </th:block>

      <div class="field">
        <label class="label" for="pw_phone">전화번호</label>
        <div class="input-wrap">
          <input class="input" id="pw_phone" name="memberPhone" type="text"
                 th:value="${me != null ? me.memberPhone : ''}" placeholder="예) 010-1234-5678">
        </div>
      </div>

      <div class="field">
        <label class="label" for="pw_idnum">생년월일(6자리)</label>
        <div class="input-wrap">
          <input class="input" id="pw_idnum" name="memberIdnum" type="text"
                 th:value="${me != null ? me.memberIdnum : ''}" placeholder="예) 990101">
        </div>
      </div>

      <div class="field">
        <label class="label" for="newPassword">새 비밀번호</label>
        <div class="input-wrap">
          <input class="input" id="newPassword" name="newPassword" type="password" placeholder="새 비밀번호">
        </div>
      </div>

      <div class="field">
        <label class="label" for="confirmPassword">비밀번호 확인</label>
        <div class="input-wrap">
          <input class="input" id="confirmPassword" name="confirmPassword" type="password" placeholder="비밀번호 확인">
        </div>
      </div>

      <div class="actions">
        <button class="btn-main" id="btnChangePw" type="submit">비밀번호 변경</button>
      </div>
    </form>

    <div class="divider"></div>

    <!-- 회원탈퇴 (주의 문구 + 동의 체크해야 버튼 활성화 / 전화번호+생년월일로 본인확인) -->
    <h2 class="sub-ttl">회원탈퇴</h2>

    <div class="warning-box">
      <p class="warn-ttl">주의하세요</p>
      <ul class="warn-list">
        <li>회원탈퇴 시 계정은 비활성화되며, 복구가 어려울 수 있습니다.</li>
        <li>결제/포인트/상담 등 연계 데이터에 영향이 있을 수 있습니다.</li>
        <li>정말 탈퇴를 원하시는 경우에만 진행해 주세요.</li>
      </ul>
      <label class="check">
        <input type="checkbox" id="agreeDelete"> 위 내용을 모두 확인했으며 탈퇴에 동의합니다.
      </label>
    </div>

    <form id="formDelete" class="form" th:action="@{/member/api/deactivate}" method="post" novalidate>
      <th:block th:if="${_csrf != null}">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      </th:block>

      <div class="field">
        <label class="label" for="del_phone">전화번호</label>
        <div class="input-wrap">
          <input class="input" id="del_phone" name="memberPhone" type="text"
                 th:value="${me != null ? me.memberPhone : ''}" placeholder="예) 010-1234-5678">
        </div>
      </div>

      <div class="field">
        <label class="label" for="del_idnum">생년월일(6자리)</label>
        <div class="input-wrap">
          <input class="input" id="del_idnum" name="memberIdnum" type="text"
                 th:value="${me != null ? me.memberIdnum : ''}" placeholder="예) 990101">
        </div>
      </div>

      <div class="actions">
        <button class="btn-danger" id="btnDelete" type="submit" disabled>회원탈퇴</button>
      </div>
    </form>

  </section>
</main>

<div class="include" th:replace="~{include/footer :: footer}"></div>
<script th:src="@{/js/js.js}"></script>
<script th:src="@{/js/chatIcon.js}"></script>
<script th:src="@{/js/gModify.js}"></script>
</body>
</html>
