<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>포인트 메인</title>
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/point.css}">
    <!-- <style>
       .point-option {
           border: 2px solid #ccc;
           border-radius: 10px;
           padding: 10px;
           margin: 10px 0;
           cursor: pointer;
           transition: 0.2s;
       }
       .point-option.selected {
           border-color: #000777;
           background-color: #e9f2ff;
       }
   </style> -->
</head>
<body>
    <!-- 헤더 -->
    <div class="include" th:replace="~{include/header :: header}"></div>

    <!-- 메인 -->
    <main class="page-point">
        
      <!-- 포인트 결제 -->
      <form id="payment-form" th:action="@{/member/point}" method="post" class="container">
        <div class="titlebar">
            <h1>포인트 결제</h1>
            <span class="small">잔여 포인트 : <b th:text="${member.memberPoint}"></b></span>
        </div>

        <section class="card split">
          <div class="payment">
            <div class="opt-grid">
              <input type="hidden" name="selectedProduct" id="selectedProduct">
              <div th:each="product : ${productList}">
                <div data-product="${product.productIdx}" class="opt point-option">
                    <div th:text="${product.productContent}" class="tag"></div>
                    <div th:text="${product.productPrice}" class="price"></div>
                </div>
              </div>
            </div>
          </div>

          <aside class="side">
            <div class="label">결제 주의사항</div>
            <div class="ask">이러한 사항이 있음으로 동의합니까?</div>
            <div class="radio-row">
                동의합니까?
              <label for="agree" class="radio-square">
                <input type="checkbox" id="agree" name="agree" value="yes"></input>
              </label>
            </div>
            <button type="submit" class="btn">결제하기</button>
          </aside>
        </section>
      </form>

    <!-- 이용 내역 -->
      <section>
        <form class="container">
        <div class="tabs">
          <div id="pointHistory" onclick="point()" class="tab active">포인트 이용 내역</div>
          <div class="tab divider">|</div>
          <div id="paymentHistory" onclick="payment()" class="tab">결제 내역</div>
        </div>
    
      <!-- 포인트 이용 내역 -->          
      <div id="point" name="point" class="history">
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th style="width:22%">일시</th>
                <th style="width:15%">구분</th>
                <th style="width:13%">변동 포인트</th>
                <th style="width:15%">내역</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="point : ${pointList}">
                <td th:text="${point.pointRegDate}"></td>
                <td th:text="${point.pointDivision}"></td>
                <td th:text="${point.pointState}"></td>
                <td th:text="${point.pointHistory}"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 결제 내역 -->    
      <div id="payment" name="payment" class="history" style="display: none;">
        <div class="scroll">
          <table>
            <thead>
              <tr>
                <th style="width:22%">일시</th>
                <th style="width:15%">충전 금액</th>
                <th style="width:13%">포인트</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="purchase : ${purchaseList}">
                <td th:text="${purchase.purchaseRegDate}"></td>
                <td th:text="${purchase.productPrice}"></td>
                <td th:text="${purchase.productContent}"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      </form>

      </section>
    </main>

    <!-- 푸터 -->
    <div class="include" th:replace="~{include/footer :: footer}"></div>

</body>

<script>
    // 탭 활성 토글
    document.querySelectorAll('.tabs .tab').forEach(tab=>{
        tab.addEventListener('click',()=>{
            if(tab.classList.contains('divider')) return;
            document.querySelectorAll('.tabs .tab').forEach(t=>t.classList.remove('active'));
            tab.classList.add('active');
        });
    });
    function point() {
        document.getElementById('point').style.display = 'block';
        document.getElementById('payment').style.display = 'none';
    }
    function payment() {
        document.getElementById('point').style.display = 'none';
        document.getElementById('payment').style.display = 'block';
    }

    const options = document.querySelectorAll('.point-option');
    const productInput = document.getElementById('selectedProduct');

    // 포인트 선택
    options.forEach(opt => {
        opt.addEventListener('click', () => {
            options.forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            productInput.value = opt.dataset.product;
        });
    });

    // 첫번째 포인트 선택
    window.addEventListener('DOMContentLoaded', () => {
        options[0].classList.add('selected');
        productInput.value = options[0].dataset.product;
    });

    // 동의 체크박스 확인
    document.getElementById('payment-form').addEventListener('submit', function(e) {
        const agree = document.getElementById('agree');
        if (!agree.checked) {
            alert("결제 주의사항에 동의해주세요.");
            e.preventDefault();
            return;
        }
    });
</script>
<script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // 전달된 alert 메세지 출력
        /*]]>*/
    </script>
</html>