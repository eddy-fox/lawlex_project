<!DOCTYPE html>
<html lang="ko" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>변호사회원가입</title>
  <link rel="stylesheet" th:href="@{/css/lJoin.css}">
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
  <div class="include" th:replace="~{include/header :: header}"></div>

  <!-- 로그인 상태별 마이페이지 진입 버튼 -->
  <div class="wrap" style="display:flex; justify-content:flex-end; gap:8px; margin:12px 0;">
    <a th:if="${session.loginUser != null}"
       class="primary-btn"
       th:href="@{/member/mypage}">
      마이페이지
    </a>
    <a th:if="${session.loginUser == null}"
       class="small-btn"
       th:href="@{/member/login(need='mypage')}">
      로그인하고 마이페이지
    </a>
  </div>

  <main class="page-lJoin">
    <section class="center-card">
      <div class="head">
        <h1 class="title">변호사 회원가입</h1>
      </div>

      <!-- 변호사 회원가입 폼 -->
      <form id="lawyerJoinForm" class="form"
            th:action="@{/lawyer/joinLawyer-oauth}"
            method="post"
            th:object="${joinLawyer}" 
            enctype="multipart/form-data"
            novalidate>

        <!-- CSRF -->
        <th:block th:if="${_csrf != null}">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        </th:block>

        <!-- 3. 이름 (아이디 아래로 내림) -->
        <div class="field">
          <input id="lawyerName"
                 name="lawyerName"
                 class="input"
                 type="text"
                 th:text="${joinLawyer.lawyerName}"
                 readonly>
        </div>

        <!-- 4. 등록번호 (이름 아래로 내림) -->
        <div class="field">
          <form th:action="@{/member/testOCR}" method="post" th:object="${lawyerAuth}" enctype="multipart/form-data">
            <div>
              <input id="lawyerIdnum"
                 name="lawyerIdnum"
                 class="input"
                 type="text"
                 th:field="*{lawyerAuth}"
                 placeholder="등록번호"
                 inputmode="numeric"
                 required> <br>

              <div>이미지 파일</div>
              <input type="text" id="imgUrl" readonly placeholder="선택된 파일명"/>
              <button type="button" id="findImgBtn">찾아보기</button> <br>
              <div>이미지 미리보기</div> <br>
              <input id="adImageFile" type="file" accept="image/*" style="display:none">
              <img id="previewImg" alt="미리보기"> <br>
            </div>
            <button type="button" id="verifyBtn">인증</button>
          </form>
        </div>

        <!-- 닉네임 -->
        <div class="field">
          <input id="lawyerNickname"
                 name="lawyerNickname"
                 class="input"
                 type="text"
                 th:field="*{lawyerNickname}"
                 placeholder="닉네임"
                 required>
        </div>

        <!-- 이메일 -->
        <div class="field">
          <input id="lawyerEmail"
                 name="lawyerEmail"
                 class="input"
                 type="email"
                 th:text="${joinLawyer.lawyerEmail}"
                 autocomplete="email"
                 readonly>
        </div>

        <!-- 사무실 주소 -->
        <div class="field">
          <input id="lawyerAddress"
                 name="lawyerAddress"
                 class="input"
                 type="text"
                 th:field="*{lawyerAddress}"
                 placeholder="사무실 주소">
        </div>

        <!-- 휴대폰 번호 -->
        <div class="field">
          <input id="lawyerPhone"
                 name="lawyerPhone"
                 class="input"
                 type="tel"
                 th:field="*{lawyerPhone}"
                 placeholder="휴대폰 번호 (예: 010-1234-5678)"
                 inputmode="numeric"
                 required>
        </div>

        <!-- 사무실(사업장) 전화번호 -->
        <div class="field">
          <input id="lawyerTel"
                 name="lawyerTel"
                 class="input"
                 type="tel"
                 th:field="*{lawyerTel}"
                 placeholder="사무실 전화번호 (선택)"
                 inputmode="numeric">
        </div>

        <!-- 관심 분야 (1개 선택) -->
        <div class="field">
          <select id="interestIdx"
                  name="interestIdx"
                  th:field="*{interestIdx}"
                  class="input"
                  required>
            <option value="" disabled selected>전문 분야 선택</option>
            <option th:each="it : ${interests}"
                    th:value="${it.interestIdx}"
                    th:text="${it.interestName}">
              형사
            </option>
          </select>
        </div>

        <!-- 한줄소개 + 상담 가능 요일/시간 -->
        <div class="field">
          <div class="inline align-start">
            <label class="photo">상담 안내</label>
            <div class="flex-1">
              <!-- 한줄소개: lawyerComment 로 name 지정 -->
              <input id="lawyerIntro"
                     name="lawyerComment"
                     class="input"
                     type="text"
                     th:field="*{lawyerComment}"
                     placeholder="한줄소개 (선택)">
              <label style="display:block; margin-top:8px;">상담 가능 요일 및 시간대 (선택)</label>
              <div class="days">
                <input type="checkbox" id="mon" value="월"><label for="mon">월</label>
                <input type="checkbox" id="tue" value="화"><label for="tue">화</label>
                <input type="checkbox" id="wed" value="수"><label for="wed">수</label>
                <input type="checkbox" id="thu" value="목"><label for="thu">목</label>
                <input type="checkbox" id="fri" value="금"><label for="fri">금</label>
                <input type="checkbox" id="sat" value="토"><label for="sat">토</label>
                <input type="checkbox" id="sun" value="일"><label for="sun">일</label>
              </div>
              <div class="inline" style="margin-top:4px;">
                <input id="timeStart" class="input" type="time" style="flex:1">
                <span style="margin:0 6px">~</span>
                <input id="timeEnd" class="input" type="time" style="flex:1">
              </div>
              <button type="button" class="small-btn" id="addTime" style="margin-top:6px;">추가</button>
              <div id="selectedList" class="selected-list"></div>
            </div>
          </div>
        </div>

        <!-- 등록증 업로드 + 동의 -->
        <div class="field">
          <div class="agree-area">
            <div class="left">
              <!-- 신분증 업로드 제거, 등록증만 유지 -->
              <input id="certImage"
                     name="certImage"
                     type="file"
                     accept="image/*"
                     style="display:none" />
              <button type="button" class="small-btn" id="certPickBtn">등록증 업로드</button>
            </div>
            <div class="right">
              <!-- 화면에서는 Y/N로 토글하지만 DB 저장은 서비스에서 1로 처리 -->
              <input type="hidden" id="lawyerAgree" name="lawyerAgree" value="N">
              <button class="small-btn" type="button" id="privacyBtn">개인 정보 수신 동의</button>
            </div>
          </div>

          <div class="inline align-start" style="margin-top:8px">
            <div class="flex-1">
              <div id="certImagePreview" class="thumb"></div>
            </div>
          </div>
          <small id="fileMsg" class="help">등록증 이미지를 첨부해주세요.</small>
          <small id="agreeMsg" class="help"></small>
        </div>

        <!-- 상담 가능 시간 JSON (선택값 서버로 전달용) -->
        <input type="hidden" id="availabilityJson" name="availabilityJson" value="[]">

        <div class="divider"></div>
        <button class="primary-btn" type="submit" id="submitBtn">회원가입</button>
      </form>
    </section>
  </main>

  <div class="include" th:replace="~{include/footer :: footer}"></div>
  <script th:src="@{/js/js.js}"></script>
  <script th:src="@{/js/chatIcon.js}"></script>
  <script th:src="@{/js/lJoin.js}"></script>
  <script th:if="${alert}" th:inline="javascript">
        /*<![CDATA[*/
        alert('[[${alert}]]'); // 전달된 alert 메세지 출력
        /*]]>*/
    </script>
</body>
</html>
